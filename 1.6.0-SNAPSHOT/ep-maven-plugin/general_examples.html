<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.1 from src/site/markdown/general_examples.md at 2019-09-06
 | Rendered using Apache Maven Fluido Skin 1.8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.1" />
    <title>Event Processing Maven Plugin &#x2013; General</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.8.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.8.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h2>Event Processing Maven Plugin</h2>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2019-09-06<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.6.0-SNAPSHOT</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://devzone.tibco.com/display/comp/TIBCO+Component+Exchange" class="externalLink" title="Component Exchange">Component Exchange</a></li>
      <li class="pull-right"><a href="https://devzone.tibco.com/dashboard.action" class="externalLink" title="DevZone">DevZone</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="usage.html" title="Usage"><span class="icon-chevron-down"></span>Usage</a>
     <ul class="nav nav-list">
      <li class="active"><a href="#"><span class="none"></span>General examples</a></li>
      <li><a href="java_examples.html" title="Java fragment examples"><span class="none"></span>Java fragment examples</a></li>
      <li><a href="java_jar_examples.html" title="Java jar examples"><span class="none"></span>Java jar examples</a></li>
      <li><a href="eventflow_examples.html" title="EventFlow fragment examples"><span class="none"></span>EventFlow fragment examples</a></li>
      <li><a href="tcs_examples.html" title="TIBCO Cloud Streaming fragment examples"><span class="none"></span>TIBCO Cloud Streaming fragment examples</a></li>
      <li><a href="liveview_examples.html" title="LiveView fragment examples"><span class="none"></span>LiveView fragment examples</a></li>
      <li><a href="application_examples.html" title="Application examples"><span class="none"></span>Application examples</a></li>
      <li><a href="contint_examples.html" title="CI examples"><span class="none"></span>CI examples</a></li>
      <li><a href="cloud_examples.html" title="Cloud examples"><span class="none"></span>Cloud examples</a></li>
     </ul></li>
    <li><a href="goals.html" title="Goals"><span class="icon-chevron-right"></span>Goals</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://www.tibco.com/" title="Tibco" class="builtBy"><img class="builtBy"  alt="Tibco" src="images/Tibco.svg"    /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<h1>General</h1>
<ul>

<li><a href="#codeline-structure">Codeline structure</a></li>
<li><a href="#dependency-scope">Dependency scope</a></li>
<li><a href="#parent-poms">Parent poms</a></li>
<li><a href="#build-test-and-install">Build, test and install</a></li>
<li><a href="#cleaning-up">Cleaning up</a></li>
<li><a href="#build-only">Build only</a></li>
<li><a href="#skipping-start-and-stop-nodes">Skipping start and stop nodes</a></li>
<li><a href="#summary-of-command-line-flags">Summary of command-line flags</a></li>
<li><a href="#multiple-test-nodes">Multiple test nodes</a></li>
<li><a href="#install-node-parameters">Install node parameters</a></li>
<li><a href="#start-node-parameters">Start node parameters</a></li>
<li><a href="#run-a-single-junit-test-case">Run a single junit test case</a></li>
<li><a href="#administration-commands-when-unit-testing">Administration commands when unit testing</a></li>
<li><a href="#usernames-and-passwords">Usernames and passwords</a></li>
<li><a href="#discovery-port">Discovery port</a></li>
<li><a href="#creating-additional-artifacts">Creating additional artifacts</a></li>
<li><a href="#javaoptions-and-nodeoptions">javaOptions and nodeOptions</a></li>
<li><a href="#debugging">Debugging</a></li>
<li><a href="#system-variables">System variables</a></li>
<li><a href="#environment-variables">Environment variables</a></li>
<li><a href="#running-tests-more-than-once">Running tests more than once</a></li>
<li><a href="#jvm-exit">JVM exit</a></li>
<li><a href="#managed-object-leak-detection-support">Managed object leak detection support</a></li>
<li><a href="#migrating-from-surefire">Migrating from surefire</a></li>
<li><a href="#additional-support-product">Additional support product</a></li>
<li><a href="#maven-archetypes">Maven Archetypes</a></li>
<li><a href="#sonarqube-analysis">SonarQube analysis</a></li>
</ul>
<p>Much of how to use the maven plugin is consistent across event processing technologies - so the non-specific usages are discussed here.</p>
<p><a name="codeline-structure"></a></p><section>
<h2><a name="Codeline_structure"></a>Codeline structure</h2>
<p>Maven has a <a class="externalLink" href="https://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html">standard directory layout</a> - this forms the basis of the recommended structure.</p>
<p><a name="dependency-scope"></a></p></section><section>
<h2><a name="Dependency_scope"></a>Dependency scope</h2>
<p>Maven defines a <a class="externalLink" href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html#Dependency_Scope">dependency scope</a> for each dependency.  So :</p>
<ul>

<li>

<p><b>compile</b> - dependency is included when compiling application, compiling test cases, running test cases and running application.  Dependency is included in shipped artifacts.</p>
</li>
<li>

<p><b>provided</b> - dependency is included when compiling application and compiling test cases.  The dependency is not included when running test cases or the application ( since its assumed that the runtime already provides this dependency ).  Dependency is not included in shipped artifacts.</p>
</li>
<li>

<p><b>runtime</b> - dependency is included when running test cases and running application.  Dependency is not included when compiling.  Dependency is included in shipped artifacts.</p>
</li>
<li>

<p><b>test</b> - dependency is included when compiling test cases and running test cases.  Dependency is not included when compiling application.  Dependency is included in shipped artifacts.</p>
</li>
</ul>
<p>One exception to this rule is cobertura - if set a a provided dependency &#xab;and&#xbb; cobertura:cobertura goal is being run, then the maven plugin will include cobertura on the classpath when testing</p>
<p><a name="parent-poms"></a></p></section><section>
<h2><a name="Parent_poms"></a>Parent poms</h2>
<p>Parent poms are provided to simplify project poms as much as possible and includes dependency version management and any common build rules.</p>
<p>These are :</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th> Use                     </th>
<th> GroupId                </th>
<th> ArtifactId           </th>
<th>  Version  </th></tr>
</thead><tbody>

<tr class="b">
<td> Common                  </td>
<td> com.tibco.ep.sb.parent </td>
<td> common               </td>
<td> StreamBase product version ( eg 10.4.0 )  </td></tr>
<tr class="a">
<td> Java fragment           </td>
<td> com.tibco.ep.sb.parent </td>
<td> ep-java-fragment     </td>
<td> StreamBase product version ( eg 10.4.0 )  </td></tr>
<tr class="b">
<td> Eventflow fragment      </td>
<td> com.tibco.ep.sb.parent </td>
<td> ep-eventflow-fragment</td>
<td> StreamBase product version ( eg 10.4.0 )  </td></tr>
<tr class="a">
<td> Liveview fragment       </td>
<td> com.tibco.ep.sb.parent </td>
<td> ep-liveview-fragment </td>
<td> StreamBase product version ( eg 10.4.0 )  </td></tr>
<tr class="b">
<td> Application             </td>
<td> com.tibco.ep.sb.parent </td>
<td> ep-application       </td>
<td> StreamBase product version ( eg 10.4.0 )  </td></tr>
<tr class="a">
<td> Application with docker </td>
<td> com.tibco.ep.sb.parent </td>
<td> ep-application-docker</td>
<td> StreamBase product version ( eg 10.4.0 )  </td></tr>
</tbody>
</table>
<p><a name="build-test-and-install"></a></p></section><section>
<h2><a name="Build.2C_test_and_install"></a>Build, test and install</h2>
<p>Run <b>mvn install</b>.  For example:</p>

<div>
<div>
<pre class="source">$ mvn install
[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building Java Fragment - hello world 3.0.0
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- ep-maven-plugin:1.0.0:install-product (default-install-product-1) @ helloworld ---
[INFO] com.tibco.ep.dtm:platform_osxx86_64:zip:3.0.0:test product is already installed manually
[INFO] 
[INFO] --- maven-compiler-plugin:3.3:compile (default-compile) @ helloworld ---
[INFO] Changes detected - recompiling the module!
[INFO] Compiling 2 source files to /Users/plord/workspace/dtmexamples/java-fragments/helloworld/target/classes
[INFO] 
[INFO] --- maven-compiler-plugin:3.3:testCompile (default-testCompile) @ helloworld ---
[INFO] Changes detected - recompiling the module!
[INFO] Compiling 1 source file to /Users/plord/workspace/dtmexamples/java-fragments/helloworld/target/test-classes
[INFO] 
[INFO] --- ep-maven-plugin:1.0.0:start-nodes (default-start-nodes) @ helloworld ---
[INFO] [A.helloworld] Starting install node
[INFO] [A.helloworld]  Installing node
[INFO] [A.helloworld]      DEVELOPMENT executables
[INFO] [A.helloworld]      File shared memory
[INFO] [A.helloworld]      7 concurrent allocation segments
[INFO] [A.helloworld]      Host name plordmac
[INFO] [A.helloworld]      Container tibco/dtm
[INFO] [A.helloworld]      Starting container services
[INFO] [A.helloworld]      Loading node configuration
[INFO] [A.helloworld]      Auditing node security
[INFO] [A.helloworld]      Administration port is 36091
[INFO] [A.helloworld]      Service name is A.helloworld
[INFO] [A.helloworld]  Node installed
[INFO] [A.helloworld] Completed install node
[INFO] [helloworld] Starting start node
[INFO] [A.helloworld] Start node 
[INFO] [A.helloworld] Loading node configuration 
[INFO] [A.helloworld] Auditing node security 
[INFO] [A.helloworld] Host name plordmac 
[INFO] [A.helloworld] Administration port is 36091 
[INFO] [A.helloworld] Service name is A.helloworld 
[INFO] [A.helloworld] Node started 
[INFO] 
[INFO] --- ep-maven-plugin:1.0.0:test-java-fragment (default-test-java-fragment) @ helloworld ---
[INFO] [helloworld] INFO: Deployment tool version: [TIBCO Distributed Transactional Memory Platform 3.0.0 (build 160118)] starting at [Wed Jan 20 10:09:36 GMT 2016]
[INFO] [helloworld] INFO: Node version: [TIBCO Distributed Transactional Memory Platform 3.0.0 (build 160118)]
[INFO] [helloworld] INFO: Starting com.tibco.ep.buildmavenplugin.surefire.Runner ...
[INFO] [helloworld] INFO: com.tibco.ep.buildmavenplugin.surefire.Runner started on JVM com_tibco_ep_buildmavenplugin_surefire_Runner0.
[INFO] [helloworld] 10:09:38.592 [main] DEBUG c.tibco.haservice.ComponentNotifier - preConfigurationInitialize
[INFO] [helloworld] 10:09:38.751 [main] DEBUG c.t.haservice.ConfigurationNotifier - set owner for configuration notifier
[INFO] [helloworld] 10:09:38.751 [main] DEBUG c.tibco.haservice.ComponentNotifier - registering admin targets
[INFO] [helloworld] 10:09:39.053 [main] DEBUG c.t.e.d.c.node.NodeNotifier - Created NodeNotifier
[INFO] [helloworld] 
[INFO] [helloworld] -------------------------------------------------------
[INFO] [helloworld] T E S T S
[INFO] [helloworld] -------------------------------------------------------
[INFO] [helloworld] Running com.tibco.ep.testcases.TestCase
[INFO] [helloworld] 10:09:39.293 [main] INFO  com.tibco.ep.testjavafragment.Main - Test Case 1
[INFO] [helloworld] 10:09:39.299 [main] INFO  com.tibco.ep.testjavafragment.Main - Test Case 2
[INFO] [helloworld] 10:09:39.299 [main] INFO  com.tibco.ep.testjavafragment.Main - Creating instance of Node A.helloworld
[INFO] [helloworld] 10:09:39.316 [main] INFO  com.tibco.ep.testjavafragment.Main - Deleting instance of Node
[INFO] [helloworld] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.108 sec
[INFO] [helloworld] 
[INFO] [helloworld] Results :
[INFO] [helloworld] 
[INFO] [helloworld] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0
[INFO] [helloworld] 
[INFO] [helloworld] 10:09:39.337 [Thread-0] DEBUG c.tibco.haservice.ComponentNotifier - postConfigurationTerminate
[INFO] [helloworld] 10:09:39.338 [Thread-0] DEBUG c.tibco.haservice.ComponentNotifier - last owner, doing node level cleanup
[INFO] [helloworld] 10:09:39.344 [Thread-0] DEBUG c.tibco.haservice.ComponentNotifier - unregistering admin targets
[INFO] [helloworld] 10:09:39.345 [Thread-0] DEBUG c.tibco.haservice.ComponentNotifier - deleting configuration notifier
[INFO] [helloworld] INFO: JVM com_tibco_ep_buildmavenplugin_surefire_Runner0 exited with status [0]
[INFO] [helloworld] Completed junit
[INFO] 
[INFO] --- ep-maven-plugin:1.0.0:stop-nodes (default-stop-nodes-1) @ helloworld ---
[INFO] [helloworld] Starting stop node
[INFO] [A.helloworld] Stopping node 
[INFO] [A.helloworld] Dtm::distribution stopping 
[INFO] [A.helloworld] application::com_tibco_ep_buildmavenplugin_surefire_Runner0 stopped 
[INFO] [A.helloworld] Node stopped 
[INFO] [helloworld] Starting remove node
[INFO] [A.helloworld] Removing node 
[INFO] [A.helloworld] Shutting down container services 
[INFO] [A.helloworld] Removing node directory 
[INFO] [A.helloworld] Node removed 
[INFO] 
[INFO] --- ep-maven-plugin:1.0.0:package-java-fragment (default-package-java-fragment) @ helloworld ---
[INFO] Building zip: /Users/plord/workspace/dtmexamples/java-fragments/helloworld/target/helloworld-3.0.0-ep-java-fragment.zip
[INFO] 
[INFO] --- maven-install-plugin:2.5.2:install (default-install) @ helloworld ---
[INFO] No primary artifact to install, installing attached artifacts instead.
[INFO] Installing /Users/plord/workspace/dtmexamples/java-fragments/helloworld/pom.xml to /Users/plord/workspace/BUILD/repository/com/tibco/ep/dtmexamples/javafragment/helloworld/3.0.0/helloworld-3.0.0.pom
[INFO] Installing /Users/plord/workspace/dtmexamples/java-fragments/helloworld/target/helloworld-3.0.0-ep-java-fragment.zip to /Users/plord/workspace/BUILD/repository/com/tibco/ep/dtmexamples/javafragment/helloworld/3.0.0/helloworld-3.0.0-ep-java-fragment.zip
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 21.507 s
[INFO] Finished at: 2016-01-20T10:09:44+00:00
[INFO] Final Memory: 31M/507M
[INFO] ------------------------------------------------------------------------
</pre></div></div>

<p><a name="cleaning-up"></a></p></section><section>
<h2><a name="Cleaning_up"></a>Cleaning up</h2>
<p>To clean up after either a failed or successful test run, use the clean target.  If any nodes are still running they will be stopped and removed before the directory is cleaned.</p>
<p>An example run is shown below :</p>

<div>
<div>
<pre class="source">$ mvn clean
[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building Java Fragment - hello world 3.0.0
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- ep-maven-plugin:1.0.0:install-product (default-install-product) @ helloworld ---
[INFO] com.tibco.ep.dtm:platform_osxx86_64:zip:3.0.0:test product is already installed manually
[INFO] 
[INFO] --- ep-maven-plugin:1.0.0:stop-nodes (default-stop-nodes) @ helloworld ---
[INFO] [helloworld] Starting stop node
[INFO] [helloworld] Starting remove node
[INFO] 
[INFO] --- maven-clean-plugin:3.0.0:clean (default-clean) @ helloworld ---
[INFO] Deleting /Users/plord/workspace/dtmexamples/java-fragments/helloworld/target
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2.998 s
[INFO] Finished at: 2016-01-20T10:14:03+00:00
[INFO] Final Memory: 17M/309M
[INFO] ------------------------------------------------------------------------
</pre></div></div>

<p><a name="build-only"></a></p></section><section>
<h2><a name="Build_only"></a>Build only</h2>
<p>To only build the java fragment (ie skip running test cases) use :</p>

<div>
<div>
<pre class="source">$ mvn -DskipTests install
</pre></div></div>

<p><a name="skipping-start-and-stop-nodes"></a></p></section><section>
<h2><a name="Skipping_start_and_stop_nodes"></a>Skipping start and stop nodes</h2>
<p>To examine the node runtime after the test cases, the node stop step can be skipped :</p>

<div>
<div>
<pre class="source">$ mvn -DskipStop install
...
[INFO] --- ep-maven-plugin:1.0.0:stop-nodes (default-stop-nodes-1) @ helloworld ---
[INFO] Stop nodes is skipped
...
$ monitor target/A.helloworld/ossm
</pre></div></div>

<p>Also, the test nodes can be stopped but not removed :</p>

<div>
<div>
<pre class="source">$ mvn -DskipRemove install
...
[INFO] --- ep-maven-plugin:1.0.0:stop-nodes (default-stop-nodes-1) @ helloworld ---
[INFO] [helloworld] Running &quot;stop node&quot;
[INFO] [A.helloworld] Stopping node 
[INFO] [A.helloworld] Dtm::distribution stopping 
[INFO] [A.helloworld] application::com_tibco_ep_buildmavenplugin_surefire_Runner0 stopped 
[INFO] [A.helloworld] Node stopped 
[INFO] Remove nodes is skipped
...
$ monitor target/A.helloworld/ossm
</pre></div></div>

<p>To re-use the same test nodes for multiple runs, the start and stop nodes can be skipped :</p>

<div>
<div>
<pre class="source">$ mvn -DskipStop install
...
$ mvn -DskipStart -DskipStop install
...
</pre></div></div>

<p>If no test cases are found, <b>skipTests</b> is automatically set to true.</p>
<p>Note that in the default case (discovery port is not specified), the selected discovery port is persisted in the build directory (by default target/discovery.port) and will be used on subsequent runs.</p>
<p><a name="summary-of-command-line-flags"></a></p></section><section>
<h2><a name="Summary_of_command-line_flags"></a>Summary of command-line flags</h2>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>  Options         </th>
<th> Install nodes </th>
<th> Start nodes </th>
<th> Run test </th>
<th> Stop nodes </th>
<th> Remove nodes </th></tr>
</thead><tbody>

<tr class="b">
<td>                  </td>
<td> yes           </td>
<td> yes         </td>
<td> yes      </td>
<td> yes        </td>
<td> yes          </td></tr>
<tr class="a">
<td> -DskipTests      </td>
<td> no            </td>
<td> no          </td>
<td> no       </td>
<td> no         </td>
<td> no           </td></tr>
<tr class="b">
<td> -DskipStart      </td>
<td> no            </td>
<td> no          </td>
<td> yes      </td>
<td> yes        </td>
<td> yes          </td></tr>
<tr class="a">
<td> -DskipStop       </td>
<td> yes           </td>
<td> yes         </td>
<td> yes      </td>
<td> no         </td>
<td> no           </td></tr>
<tr class="b">
<td> -DskipRemove     </td>
<td> yes           </td>
<td> yes         </td>
<td> yes      </td>
<td> yes        </td>
<td> no           </td></tr>
<tr class="a">
<td> -DskipInstall    </td>
<td> no            </td>
<td> yes         </td>
<td> yes      </td>
<td> yes        </td>
<td> yes          </td></tr>
<tr class="b">
<td> -DskipStart -DskipStop </td>
<td> no      </td>
<td> no          </td>
<td> yes      </td>
<td> no         </td>
<td> no           </td></tr>
<tr class="a">
<td> -DinstallOnly    </td>
<td> yes           </td>
<td> no          </td>
<td> no       </td>
<td> no         </td>
<td> no           </td></tr>
</tbody>
</table>
<p><a name="multiple-test-nodes"></a></p></section><section>
<h2><a name="Multiple_test_nodes"></a>Multiple test nodes</h2>
<p>Multiple test nodes can be defined to override a single node named A. For example :</p>

<div>
<div>
<pre class="source">...
            &lt;plugin&gt;
                &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
                &lt;artifactId&gt;ep-maven-plugin&lt;/artifactId&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;configuration&gt;
                    &lt;nodes&gt;
                        &lt;node&gt;A&lt;/node&gt;
                        &lt;node&gt;B&lt;/node&gt;
                        &lt;node&gt;C&lt;/node&gt;
                    &lt;/nodes&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
...
</pre></div></div>

<p>The application code, test cases and junit are deployed to the three specified test nodes :</p>
<p><img src="uml/three-node-junit.svg" alt="Three node junit test" /></p>
<p>A variation of this is to only run junit on one node :</p>

<div>
<div>
<pre class="source">...
            &lt;plugin&gt;
                &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
                &lt;artifactId&gt;ep-maven-plugin&lt;/artifactId&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;configuration&gt;
                    &lt;nodes&gt;
                        &lt;node&gt;A&lt;/node&gt;
                        &lt;node&gt;B&lt;/node&gt;
                        &lt;node&gt;C&lt;/node&gt;
                    &lt;/nodes&gt;
                    &lt;serviceName&gt;A.helloworld&lt;/serviceName&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
...
</pre></div></div>

<p><img src="uml/three-node-one-junit.svg" alt="One node junit test" /></p>
<p>When test cases involve high availability tests, then it may be necessary to start a test application on all nodes before starting junit :</p>

<div>
<div>
<pre class="source">...
            &lt;plugin&gt;
                &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
                &lt;artifactId&gt;ep-maven-plugin&lt;/artifactId&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;configuration&gt;
                    &lt;nodes&gt;
                        &lt;node&gt;A&lt;/node&gt;
                        &lt;node&gt;B&lt;/node&gt;
                        &lt;node&gt;C&lt;/node&gt;
                    &lt;/nodes&gt;
                    &lt;serviceName&gt;A.helloworld&lt;/serviceName&gt;
                    &lt;testMain&gt;com.tibco.ep.dtm.appdeploytest.Main&lt;/testMain&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
...
</pre></div></div>

<p><img src="uml/testmain.svg" alt="Test main" /></p>
<p><a name="install-node-parameters"></a></p></section><section>
<h2><a name="Install_node_parameters"></a>Install node parameters</h2>
<p>Install node parameters can be specified via &#xab;installArguments&#xbb; option - see epadmin help for permitted parameters</p>
<p>For example :</p>

<div>
<div>
<pre class="source">...
            &lt;plugin&gt;
                &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
                &lt;artifactId&gt;ep-maven-plugin&lt;/artifactId&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;configuration&gt;
                    &lt;installArguments&gt;
                        &lt;buildtype&gt;DEVELOPMENT&lt;/buildtype&gt;
                    &lt;/installArguments&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
...
</pre></div></div>

<p><a name="start-node-parameters"></a></p></section><section>
<h2><a name="Start_node_parameters"></a>Start node parameters</h2>
<p>Start node parameters can be specified via &#xab;startArguments&#xbb; option - see epadmin help for permitted parameters.</p>
<p>For example :</p>

<div>
<div>
<pre class="source">...
            &lt;plugin&gt;
                &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
                &lt;artifactId&gt;ep-maven-plugin&lt;/artifactId&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;configuration&gt;
                    &lt;startArguments&gt;
                        &lt;maxretries&gt;2000&lt;/maxretries&gt;
                    &lt;/startArguments&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
...
</pre></div></div>

<p><a name="run-a-single-junit-test-case"></a></p></section><section>
<h2><a name="Run_a_single_junit_test_case"></a>Run a single junit test case</h2>
<p>Running a single junit test case is possible by passing the &#xab;test&#xbb; maven property. for example :</p>

<div>
<div>
<pre class="source">$ mvn install -Dtest=FilterTest
</pre></div></div>

<p><a name="administration-commands-when-unit-testing"></a></p></section><section>
<h2><a name="Administration_commands_when_unit_testing"></a>Administration commands when unit testing</h2>
<p>Since maven has only one phase (test) for unit testing, its not possible to configure administration commands in a unit test.  However, it is possible to use integration instead of unit testing in the java-fragment which does allow for administration commands.  An example is shown below :</p>

<div>
<div>
<pre class="source">....
            &lt;plugin&gt;
                &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
                &lt;artifactId&gt;ep-maven-plugin&lt;/artifactId&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;

                &lt;executions&gt;

                    &lt;execution&gt;
                        &lt;id&gt;start nodes&lt;/id&gt;
                        &lt;phase&gt;pre-integration-test&lt;/phase&gt;
                        &lt;goals&gt;&lt;goal&gt;start-nodes&lt;/goal&gt;&lt;/goals&gt;
                    &lt;/execution&gt;

                    &lt;execution&gt;
                        &lt;id&gt;enable statistics&lt;/id&gt;
                        &lt;phase&gt;pre-integration-test&lt;/phase&gt;
                        &lt;goals&gt;&lt;goal&gt;administer-nodes&lt;/goal&gt;&lt;/goals&gt;
                        &lt;configuration&gt;
                            &lt;command&gt;enable&lt;/command&gt;
                            &lt;target&gt;statistics&lt;/target&gt;
                            &lt;arguments&gt;
                                &lt;statistics&gt;transaction,object&lt;/statistics&gt;
                            &lt;/arguments&gt;
                        &lt;/configuration&gt;
                    &lt;/execution&gt;

                    &lt;execution&gt;
                        &lt;id&gt;test nodes&lt;/id&gt;
                        &lt;phase&gt;integration-test&lt;/phase&gt;
                        &lt;goals&gt;&lt;goal&gt;test-java-fragment&lt;/goal&gt;&lt;/goals&gt;
                    &lt;/execution&gt;

                    &lt;execution&gt;
                        &lt;id&gt;display statistics&lt;/id&gt;
                        &lt;phase&gt;integration-test&lt;/phase&gt;
                        &lt;goals&gt;&lt;goal&gt;administer-nodes&lt;/goal&gt;&lt;/goals&gt;
                        &lt;configuration&gt;
                            &lt;command&gt;display&lt;/command&gt;
                            &lt;target&gt;statistics&lt;/target&gt;
                            &lt;arguments&gt;
                                &lt;statistics&gt;transaction,object&lt;/statistics&gt;
                            &lt;/arguments&gt;
                        &lt;/configuration&gt;
                    &lt;/execution&gt;

                    &lt;execution&gt;
                        &lt;id&gt;stop nodes&lt;/id&gt;
                        &lt;phase&gt;post-integration-test&lt;/phase&gt;
                        &lt;goals&gt;&lt;goal&gt;stop-nodes&lt;/goal&gt;&lt;/goals&gt;
                    &lt;/execution&gt;

                &lt;/executions&gt;

            &lt;/plugin&gt;
....
</pre></div></div>

<p>One such use is failover testing with the <b>kill node</b> commmand :</p>

<div>
<div>
<pre class="source">....
                    &lt;execution&gt;
                        &lt;id&gt;kill node A&lt;/id&gt;
                        &lt;phase&gt;integration-test&lt;/phase&gt;
                        &lt;goals&gt;&lt;goal&gt;administer-nodes&lt;/goal&gt;&lt;/goals&gt;
                        &lt;configuration&gt;
                            &lt;skipTests&gt;${skipTests}&lt;/skipTests&gt;
                            &lt;serviceName&gt;A.${project.artifactId}&lt;/serviceName&gt;
                            &lt;command&gt;kill&lt;/command&gt;
                            &lt;target&gt;node&lt;/target&gt;
                        &lt;/configuration&gt;
                    &lt;/execution&gt;
....
</pre></div></div>

<p><a name="usernames-and-passwords"></a></p></section><section>
<h2><a name="Usernames_and_passwords"></a>Usernames and passwords</h2>
<p>Usually when testing, node authentication works via the platform credentials - however, the user name and password can be provided if required :</p>

<div>
<div>
<pre class="source">....
                    &lt;execution&gt;
                        &lt;id&gt;display statistics&lt;/id&gt;
                        &lt;phase&gt;integration-test&lt;/phase&gt;
                        &lt;goals&gt;&lt;goal&gt;administer-nodes&lt;/goal&gt;&lt;/goals&gt;
                        &lt;configuration&gt;
                            &lt;skipTests&gt;${skipTests}&lt;/skipTests&gt;
                            &lt;command&gt;display&lt;/command&gt;
                            &lt;target&gt;statistics&lt;/target&gt;
                            &lt;userName&gt;guest&lt;/userName&gt;
                            &lt;password&gt;guest&lt;/password&gt;
                            &lt;arguments&gt;
                                &lt;statistics&gt;transaction,object&lt;/statistics&gt;
                            &lt;/arguments&gt;
                        &lt;/configuration&gt;
                    &lt;/execution&gt;
....
</pre></div></div>

<p><a name="discovery-port"></a></p></section><section>
<h2><a name="Discovery_port"></a>Discovery port</h2>
<p>It is assumed that running builds and test cases with maven might be on a shared development server - hence the default for the discovery port is to choose a unused port to avoid conflicts with other developers.</p>
<p>If this isn&#x2019;t the case, then the discovery port can be fixed with :</p>

<div>
<div>
<pre class="source">....
            &lt;plugin&gt;
                &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
                &lt;artifactId&gt;ep-maven-plugin&lt;/artifactId&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;configuration&gt;
                    &lt;discoveryPort&gt;4000&lt;/discoveryPort&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
....
</pre></div></div>

<p>Or on the command line :</p>

<div>
<div>
<pre class="source">  $ mvn -DiscoveryPort=4000 ...
</pre></div></div>

<p><a name="creating-additional-artifacts"></a></p></section><section>
<h2><a name="Creating_additional_artifacts"></a>Creating additional artifacts</h2>
<p>Other maven plugins can be configured to generate additional artifacts.<br />
Some examples are shown below :</p>

<div>
<div>
<pre class="source">....
            &lt;!-- create a source jar file --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;
                &lt;version&gt;2.4&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;phase&gt;package&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;jar-no-fork&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
            
            &lt;!-- create a javadoc jar file --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-javadoc-plugin&lt;/artifactId&gt;
                &lt;version&gt;2.10.3&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;phase&gt;package&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;jar&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
....
</pre></div></div>

<p>The <a class="externalLink" href="https://maven.apache.org/plugins/maven-source-plugin/">maven-source-plugin</a> will include any files found in source directory paths - so will include java, eventflow and liveview source files.</p>
<p><a name="javaoptions-and-nodeoptions"></a></p></section><section>
<h2><a name="javaOptions_and_nodeOptions"></a>javaOptions and nodeOptions</h2>
<p>Node deployment supports both java options and node options.</p>
<ul>

<li>

<p><b>javaOptions</b> in the pom.xml allows setting options to pass to the JVM. For example garbage collection flags.  See also <a class="externalLink" href="http://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html">http://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html</a> for details.  Java options may also be set on the maven command line using <b>-Doptions</b>.</p>
</li>
<li>

<p><b>nodeOptions</b> in the pom.xml allows setting of the node deployment parameters.  See <b>java -jar $TIBCO_EP_HOME/distrib/kabira/java/deploy.jar help</b>. Node options may also be set on the maven command line using <b>-DnodeOptions</b>.</p>
</li>
</ul>
<p><a name="debugging"></a></p></section><section>
<h2><a name="Debugging"></a>Debugging</h2>
<p>To see what classes are being loaded by the deployed application, enable the verbose flag to the jvm :</p>

<div>
<div>
<pre class="source">            &lt;plugin&gt;
                &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
                &lt;artifactId&gt;ep-maven-plugin&lt;/artifactId&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;configuration&gt;
                    &lt;javaOptions&gt;
                        &lt;javaOption&gt;-verbose&lt;/javaOption&gt;
                    &lt;/javaOptions&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;  
</pre></div></div>

<p>To capture the garbage collection log ( see also <a class="externalLink" href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning">https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning</a> ) on the deployed application :</p>

<div>
<div>
<pre class="source">            &lt;plugin&gt;
                &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
                &lt;artifactId&gt;ep-maven-plugin&lt;/artifactId&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;configuration&gt;
                    &lt;javaOptions&gt;
                        &lt;javaOption&gt;-XX:+PrintGCDetails&lt;/javaOption&gt;
                        &lt;javaOption&gt;-XX:+PrintGCTimeStamps&lt;/javaOption&gt;
                        &lt;javaOption&gt;-XX:+PrintGCDateStamps&lt;/javaOption&gt;
                        &lt;javaOption&gt;-XX:+UseGCLogFileRotation&lt;/javaOption&gt;
                        &lt;javaOption&gt;-XX:NumberOfGCLogFiles=10&lt;/javaOption&gt;
                        &lt;javaOption&gt;-XX:GCLogFileSize=100M&lt;/javaOption&gt;
                        &lt;javaOption&gt;-Xloggc:gc.log&lt;/javaOption&gt;		    
                    &lt;/javaOptions&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;  
</pre></div></div>

<p>Note that this log will appear in the target node&#x2019;s runtime directory.</p>
<p>To capture the flight recorder log ( see also <a class="externalLink" href="https://docs.oracle.com/javacomponents/jmc-5-5/jfr-runtime-guide/toc.htm">https://docs.oracle.com/javacomponents/jmc-5-5/jfr-runtime-guide/toc.htm</a> ) on the deployed application :</p>

<div>
<div>
<pre class="source">            &lt;plugin&gt;
                &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
                &lt;artifactId&gt;ep-maven-plugin&lt;/artifactId&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;configuration&gt;
                    &lt;javaOptions&gt;
                        &lt;javaOption&gt;-XX:+UnlockCommercialFeatures&lt;/javaOption&gt;
                        &lt;javaOption&gt;-XX:+FlightRecorder&lt;/javaOption&gt;
                        &lt;javaOption&gt;-XX:StartFlightRecording=settings=profile,name=perf,dumponexit=true,filename=perf.jfr&lt;/javaOption&gt;
                    &lt;/javaOptions&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;  
</pre></div></div>

<p>Note that this log will appear in the target node&#x2019;s runtime directory.</p>
<p>To enable maven debugging, use the -X option to maven.</p>

<div>
<div>
<pre class="source">$ mvn -X ...
</pre></div></div>

<p>To start the runtime in DEVELOPMENT mode and to run test cases in DEVELOPMENT mode use :</p>

<div>
<div>
<pre class="source">$ mvn -Dbuild=DEVELOPMENT ...         
</pre></div></div>

<p>To start java debugging in unit tests, use the -Doptions option to pass additional deployment parameters and attach a java debugger when prompted :</p>

<div>
<div>
<pre class="source">$ mvn -Doptions=remotedebug=true,suspend=true,remotedebugport=8000 ..
...
[INFO] --- ep-maven-plugin:1.0.0:test-java-fragment (default-test-java-fragment) @ helloworld ---
[INFO] [dtm] INFO: Deployment tool version: [TIBCO Distributed Transactional Memory Platform 3.0.0 (build 160315)] starting at [Thu Mar 17 10:42:35 GMT 2016]
[INFO] [dtm] INFO: Node version: [TIBCO Distributed Transactional Memory Platform 3.0.0 (build 160315)]
[INFO] [dtm] INFO: Starting com.tibco.ep.buildmavenplugin.surefire.Runner on node A.helloworld ...
[INFO] [dtm] INFO: com.tibco.ep.buildmavenplugin.surefire.Runner started on JVM com_tibco_ep_buildmavenplugin_surefire_Runner0 on node A.helloworld.
[INFO] [A.helloworld] Listening for transport dt_socket at address: 8000
</pre></div></div>

<p>In the eclipse debugger, for example, you can set a break point on your first test case and use Debug Configurations to attach :</p>
<p><img src="images/eclipse_attach.png" alt="Eclipse attach" /></p>
<p>and debug :</p>
<p><img src="images/eclipse_debug.png" alt="Eclipse debug" /></p>
<p>When running integration tests with application archives, the deploy tool debug=true option can be passed on the command line :</p>

<div>
<div>
<pre class="source">$ mvn -Doptions=debug=true ..  
</pre></div></div>

<p><a name="system-variables"></a></p></section><section>
<h2><a name="System_variables"></a>System variables</h2>
<p>Java system variables may be set using the <b>systemPropertyVariables</b> configuration option :</p>

<div>
<div>
<pre class="source">            &lt;plugin&gt;
                &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
                &lt;artifactId&gt;ep-maven-plugin&lt;/artifactId&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;configuration&gt;
                    &lt;systemPropertyVariables&gt;
                        &lt;MyVariable&gt;MyValue&lt;/MyVariable&gt;
                    &lt;/systemPropertyVariables&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;  
</pre></div></div>

<p>System variables can also be set using javaOptions :</p>

<div>
<div>
<pre class="source">            &lt;plugin&gt;
                &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
                &lt;artifactId&gt;ep-maven-plugin&lt;/artifactId&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;configuration&gt;
                    &lt;javaOptions&gt;
                        &lt;javaOption&gt;-DMyVariable=MyValue&lt;/javaOption&gt;
                    &lt;/javaOptions&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;  
</pre></div></div>

<p><a name="environment-variables"></a></p></section><section>
<h2><a name="Environment_variables"></a>Environment variables</h2>
<p>Occasionally environment variables need to be set to support 3rdparty libraries.  The <b>environmentVariables</b> configuration option allows setting environment variables to created processes :</p>

<div>
<div>
<pre class="source">            &lt;plugin&gt;
                &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
                &lt;artifactId&gt;ep-maven-plugin&lt;/artifactId&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;configuration&gt;
                    &lt;environmentVariables&gt;
                        &lt;ORACLE_HOME&gt;/home/oracle&lt;/ORACLE_HOME&gt;
                    &lt;/environmentVariables&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;  
</pre></div></div>

<p>These can also be set on the command-line :</p>

<div>
<div>
<pre class="source">$ mvn -DenvironmentVariables=ORACLE_HOME=/home/oracle,SYBASE_HOME=/home/sybase ...
</pre></div></div>

<p><a name="running-tests-more-than-once"></a></p></section><section>
<h2><a name="Running_tests_more_than_once"></a>Running tests more than once</h2>
<p>Its possible to run tests multiple time = for example with different configurations.  An example is show below that runs tests with the runtime in DEVELOPMENT mode first then PRODUCTION :</p>

<div>
<div>
<pre class="source">            &lt;plugin&gt;
                &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
                &lt;artifactId&gt;ep-maven-plugin&lt;/artifactId&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;phase&gt;test&lt;/phase&gt;
                        &lt;id&gt;DEVELOPMENT&lt;/id&gt;
                        &lt;configuration&gt;
                            &lt;buildtype&gt;DEVELOPMENT&lt;/buildtype&gt;
                        &lt;/configuration&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;start-nodes&lt;/goal&gt;
                            &lt;goal&gt;test-java-fragment&lt;/goal&gt;
                            &lt;goal&gt;stop-nodes&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                    &lt;execution&gt;
                        &lt;phase&gt;test&lt;/phase&gt;
                        &lt;id&gt;PRODUCTION&lt;/id&gt;
                        &lt;configuration&gt;
                            &lt;buildtype&gt;PRODUCTION&lt;/buildtype&gt;
                        &lt;/configuration&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;start-nodes&lt;/goal&gt;
                            &lt;goal&gt;test-java-fragment&lt;/goal&gt;
                            &lt;goal&gt;stop-nodes&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;  
</pre></div></div>

<p><a name="jvm-exit"></a></p></section><section>
<h2><a name="JVM_exit"></a>JVM exit</h2>
<p>As with any JVM running on a node, the JVM exits when all non-daemon threads complete - see <a class="externalLink" href="http://devzone.tibco.com/sites/streambase/latest/sb/sb-product/documentation/developersguide/ch04s01.html">the developers guide</a>. However, sometimes test cases do have threads that are not designed to complete - in this case, the JVM running the tests can be forced to call exit thus allowing the test case to always complete :</p>

<div>
<div>
<pre class="source">            &lt;plugin&gt;
                &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
                &lt;artifactId&gt;ep-maven-plugin&lt;/artifactId&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;configuration&gt;
                    &lt;useSystemExit&gt;true&lt;/useSystemExit&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;  
</pre></div></div>

<p><a name="managed-object-leak-detection-support"></a></p></section><section>
<h2><a name="Managed_object_leak_detection_support"></a>Managed object leak detection support</h2>
<p>The DTM unit test framework supports detecting managed object leaks.  Sometimes a package is designed to create managed objects and never delete them - such objects need to be masked from leak detection to avoid false results.</p>
<p>The unit test framework allows specifying a list of managed object class names to ignore during leak detection :</p>

<div>
<div>
<pre class="source">            &lt;plugin&gt;
                &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
                &lt;artifactId&gt;ep-maven-plugin&lt;/artifactId&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;configuration&gt;
                    &lt;ignoreLeaks&gt;
                        &lt;!-- list of manage object class names to be ignore from leak detection --&gt;
                        &lt;ignoreLeak&gt;com.company.Singleton&lt;/ignoreLeak&gt;
                        &lt;ignoreLeak&gt;com.company.NotInteresting&lt;/ignoreLeak&gt;
                    &lt;/ignoreLeaks&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;  
</pre></div></div>

<p>By default this applies to the current unit test cases only.  However, if these managed objects should also be ignored by downstream packages, the list of class names can be added to the jar <b>META-INF/MANIFEST.MF</b> entry <b>IgnoreLeaks</b>, for example :</p>

<div>
<div>
<pre class="source">Manifest-Version: 1.0
Implementation-Title: My package
Implementation-Version: 1.0.0
Implementation-Vendor-Id: com.tibco.ep.dtm:highavailability
IgnoreLeaks: com.company.Singleton,com.company.NotInteresting
Created-By: Apache Maven 3.5.0
Build-Jdk: 1.8.0_151
Implementation-URL: http://www.tibco.com
Implementation-Vendor: TIBCO Software Inc.
</pre></div></div>

<p>To make this easier, the maven plugin sets the maven variable <b>${ignoreLeaks}</b> than can be used with the <a class="externalLink" href="https://maven.apache.org/plugins/maven-jar-plugin/">maven jar plugin</a>, for example :</p>

<div>
<div>
<pre class="source">            &lt;plugin&gt;
                &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
                &lt;artifactId&gt;ep-maven-plugin&lt;/artifactId&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;configuration&gt;
                    &lt;ignoreLeaks&gt;
                        &lt;!-- list of manage object class names to be ignore from leak detection --&gt;
                        &lt;ignoreLeak&gt;com.company.Singleton&lt;/ignoreLeak&gt;
                        &lt;ignoreLeak&gt;com.company.NotInteresting&lt;/ignoreLeak&gt;
                    &lt;/ignoreLeaks&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;archive&gt;
                        &lt;manifestEntries&gt;
                            &lt;!-- ${ignoreLeaks} created from ep-maven-plugin to add to jar mainifest for downstream use --&gt;
                            &lt;IgnoreLeaks&gt;${ignoreLeaks}&lt;/IgnoreLeaks&gt;
                        &lt;/manifestEntries&gt;
                    &lt;/archive&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
</pre></div></div>

<p><a name="migrating-from-surefire"></a></p></section><section>
<h2><a name="Migrating_from_surefire"></a>Migrating from surefire</h2>
<p>To migrate junit test cases running under maven-surefire-plugin to ep-maven-plugin so that tests cases are run on a node simply replace the surefire plugin :</p>

<div>
<div>
<pre class="source">            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
</pre></div></div>

<p>with :</p>

<div>
<div>
<pre class="source">            &lt;plugin&gt;
                &lt;groupId&gt;com.tibco.ep&lt;/groupId&gt;
                &lt;artifactId&gt;ep-maven-plugin&lt;/artifactId&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
            &lt;/plugin&gt;
</pre></div></div>

<p><a name="additional-support-product"></a></p></section><section>
<h2><a name="Additional_support_product"></a>Additional support product</h2>
<p>On occasion, support may request installing the additional support release - this includes additional files to run the product in DEVELOPMENT mode to aid diagnosing problems.  This can be included in a project build thus :</p>

<div>
<div>
<pre class="source">    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.tibco.ep.dtm&lt;/groupId&gt;
            &lt;artifactId&gt;support_platform_${com.tibco.platform}${com.tibco.arch}&lt;/artifactId&gt;
            &lt;type&gt;zip&lt;/type&gt;
            &lt;version&gt;version&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
</pre></div></div>

<p><a name="maven-archetypes"></a></p></section><section>
<h2><a name="Maven_Archetypes"></a>Maven Archetypes</h2>
<p><a class="externalLink" href="https://maven.apache.org/guides/introduction/introduction-to-archetypes.html">Maven archetypes</a> are templates that can be quickly instantiated into a project after providing some variables.</p>
<p>The archetype site catalog contains the following archetypes :</p>
<ul>

<li>

<p><b>eventflow-fragment-archetype</b> - creates a project containing a single eventflow fragment</p>
</li>
<li>

<p><b>java-fragment-archetype</b>&gt; - creates a project containing a single java fragment</p>
</li>
<li>

<p><b>liveview-fragment-archetype</b> - creates a project containing a single liveview fragment</p>
</li>
<li>

<p><b>application-archetype</b> - creates a project containing a single application archive</p>
</li>
<li>

<p><b>application-docker-archetype</b> - creates a project containing a single application archive.  With docker support.</p>
</li>
<li>

<p><b>eventflow-application-archetype</b> - creates a project containing a module for an eventflow fragment and a second module for an application archive that includes the eventflow fragment</p>
</li>
<li>

<p><b>eventflow-application-docker-archetype</b> - creates a project containing a module for an eventflow fragment and a second module for an application archive that includes the eventflow fragment.  With docker support.</p>
</li>
<li>

<p><b>java-application-archetype</b> - creates a project containing a module for an java fragment and a second module for an application archive that includes the java fragment</p>
</li>
<li>

<p><b>java-application-docker-archetype</b> - creates a project containing a module for an java fragment and a second module for an application archive that includes the java fragment.  With docker support.</p>
</li>
<li>

<p><b>liveview-application-archetype</b> - creates a project containing a module for an liveview fragment and a second module for an application archive that includes the liveview fragment</p>
</li>
<li>

<p><b>liveview-application-docker-archetype</b> - creates a project containing a module for an liveview fragment and a second module for an application archive that includes the liveview fragment.  With docker support.</p>
</li>
</ul>
<p>Projects can be created from the archetype via the command-line, eclipse new project wizard or Studio new project wizard.</p>
<p>Note that a requirement for <a class="externalLink" href="https://maven.apache.org/archetype/maven-archetype-plugin/generate-mojo.html">archetype:generate</a> is that the archetype catalog is available the repository section in settings.xml.</p>
<p>To create a project interactively from the command-line run :</p>

<div>
<div>
<pre class="source">$ mvn archetype:generate -DinteractiveMode=true
[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building Maven Stub Project (No POM) 1
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] &gt;&gt;&gt; maven-archetype-plugin:2.4:generate (default-cli) @ standalone-pom &gt;&gt;&gt;
[INFO] 
[INFO] &lt;&lt;&lt; maven-archetype-plugin:2.4:generate (default-cli) @ standalone-pom &lt;&lt;&lt;
[INFO] 
[INFO] --- maven-archetype-plugin:2.4:generate (default-cli) @ standalone-pom ---
[INFO] Generating project in Interactive mode
[INFO] No archetype defined. Using maven-archetype-quickstart (org.apache.maven.archetypes:maven-archetype-quickstart:1.0)
Choose archetype:
1: http://artifacts.tibco.com/artifactory/ep-snapshots/archetype-catalog.xml -&gt; com.tibco.ep:eventflow-fragment-archetype (Event Processing EventFlow Fragment Archetype)
2: http://artifacts.tibco.com/artifactory/ep-snapshots/archetype-catalog.xml -&gt; com.tibco.ep:java-fragment-archetype (Event Processing Java Fragment Archetype)
3: http://artifacts.tibco.com/artifactory/ep-snapshots/archetype-catalog.xml -&gt; com.tibco.ep:liveview-fragment-archetype (Event Processing LiveView Fragment Archetype)
4: http://artifacts.tibco.com/artifactory/ep-snapshots/archetype-catalog.xml -&gt; com.tibco.ep:application-archetype (Event Processing Application Archetype)
5: http://artifacts.tibco.com/artifactory/ep-snapshots/archetype-catalog.xml -&gt; com.tibco.ep:eventflow-application-archetype (Event Processing EventFlow Application Archetype)
6: http://artifacts.tibco.com/artifactory/ep-snapshots/archetype-catalog.xml -&gt; com.tibco.ep:java-application-archetype (Event Processing Java Application Archetype)
7: http://artifacts.tibco.com/artifactory/ep-snapshots/archetype-catalog.xml -&gt; com.tibco.ep:liveview-application-archetype (Event Processing LiveView Application Archetype)
Choose a number or apply filter (format: [groupId:]artifactId, case sensitive contains): : 
...
</pre></div></div>

<p>To create a project in batch mode from the command-line run :</p>

<div>
<div>
<pre class="source">$ mvn archetype:generate -B \
   -DarchetypeGroupId=com.tibco.ep -DarchetypeArtifactId=eventflow-fragment-archetype -DarchetypeVersion=10.1.0 \
   -DgroupId=com.tibco.ep -DartifactId=effrag -Dpackage=com.tibco.ep.effrag -Dversion=1.0.0 -Dname=&quot;hello world&quot; -Drepository=settings.xml
[INFO] Scanning for projects...
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building Maven Stub Project (No POM) 1
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] &gt;&gt;&gt; maven-archetype-plugin:2.4:generate (default-cli) @ standalone-pom &gt;&gt;&gt;
[INFO] 
[INFO] &lt;&lt;&lt; maven-archetype-plugin:2.4:generate (default-cli) @ standalone-pom &lt;&lt;&lt;
[INFO] 
[INFO] --- maven-archetype-plugin:2.4:generate (default-cli) @ standalone-pom ---
[INFO] Generating project in Batch mode
Downloading: http://artifacts.tibco.com/ep-maven-virtual/com/tibco/ep/eventflow-fragment-archetype/10.1.0/maven-metadata.xml
Downloading: http://artifacts.tibco.com/ep-snapshots/com/tibco/ep/eventflow-fragment-archetype/10.1.0/maven-metadata.xml
Downloaded: http://artifacts.tibco.com/ep-snapshots/com/tibco/ep/eventflow-fragment-archetype/10.1.0/maven-metadata.xml (991 B at 1.8 KB/sec)
Downloaded: http://artifacts.tibco.com/ep-maven-virtual/com/tibco/ep/eventflow-fragment-archetype/10.1.0/maven-metadata.xml (991 B at 1.4 KB/sec)
[INFO] ----------------------------------------------------------------------------
[INFO] Using following parameters for creating project from Archetype: eventflow-fragment-archetype:10.1.0
[INFO] ----------------------------------------------------------------------------
[INFO] Parameter: groupId, Value: com.tibco.ep
[INFO] Parameter: artifactId, Value: effrag
[INFO] Parameter: version, Value: 1.0.0
[INFO] Parameter: package, Value: com.tibco.ep.effrag
[INFO] Parameter: packageInPathFormat, Value: com/tibco/ep/effrag
[INFO] Parameter: eventflowDirectory, Value: src/main/eventflow
[INFO] Parameter: package, Value: com.tibco.ep.effrag
[INFO] Parameter: version, Value: 1.0.0
[INFO] Parameter: name, Value: hello world
[INFO] Parameter: groupId, Value: com.tibco.ep
[INFO] Parameter: repository, Value: settings.xml
[INFO] Parameter: artifactId, Value: effrag
[INFO] project created from Archetype in dir: /Users/plord/workspace/test-archetypes/effrag
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2.351s
[INFO] Finished at: Mon Jan 30 15:50:38 GMT 2017
[INFO] Final Memory: 15M/491M
[INFO] ------------------------------------------------------------------------
</pre></div></div>

<p>The generated project makes use of a common parent pom for each product release - this parent pom defines common dependency versions ( using managed dependencies ) to help keep project configurations simple.  The version of the parent pom matches the main product version, so to upgrade a project from one product version to another, only the version of the parent need change :</p>

<div>
<div>
<pre class="source">....
    &lt;!-- common definitions for this version of StreamBase --&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.tibco.ep.sb.parent&lt;/groupId&gt;
        &lt;artifactId&gt;ep-java-fragment&lt;/artifactId&gt;
        &lt;version&gt;10.4.0&lt;/version&gt;
    &lt;/parent&gt;
....
</pre></div></div>

<p>Projects requiring additional common definitions are encouraged to create a local parent pom :</p>

<div>
<div>
<pre class="source">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;

    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.company&lt;/groupId&gt;
    &lt;artifactId&gt;parent&lt;/artifactId&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;

    &lt;!-- common definitions for this version of StreamBase --&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.tibco.ep.sb.parent&lt;/groupId&gt;
        &lt;artifactId&gt;ep-java-fragment&lt;/artifactId&gt;
        &lt;version&gt;10.4.0&lt;/version&gt;
    &lt;/parent&gt;

....
    local definitions
....
&lt;/project&gt;
</pre></div></div>

<p>and use this in the project pom.xml :</p>

<div>
<div>
<pre class="source">....
    &lt;!-- common definitions --&gt;
    &lt;parent&gt;
        &lt;groupId&gt;com.company&lt;/groupId&gt;
        &lt;artifactId&gt;parent&lt;/artifactId&gt;
        &lt;version&gt;1.0.0&lt;/version&gt;
    &lt;/parent&gt;
....
</pre></div></div>

<p><a name="sonarqube-analysis"></a></p></section><section>
<h2><a name="SonarQube_analysis"></a>SonarQube analysis</h2>
<p>A standard maven plugin for SonarQube can be used to gather and publish data to a <a class="externalLink" href="http://www.sonarqube.org/">SonarQube</a> server.  An example pom.xml is shown below :</p>

<div>
<div>
<pre class="source">....
    &lt;properties&gt;
        &lt;sonar.host.url&gt;http://somewebaddress&lt;/sonar.host.url&gt;
        &lt;sonar.projectName&gt;${projectgroupId}.${projectartifactId}&lt;/sonar.projectName&gt;
        &lt;sonar.junit.reportsPath&gt;${project.build.directory}/test-reports&lt;/sonar.junit.reportsPath&gt;
        &lt;sonar.working.directory&gt;${project.build.directory}${file.separator}sonar&lt;/sonar.working.directory&gt;
        &lt;sonar.cobertura.reportPath&gt;${project.build.directory}/site/cobertura/coverage.xml&lt;/sonar.cobertura.reportPath&gt;
    &lt;/properties&gt;
....
    &lt;build&gt;
        &lt;plugins&gt;

            &lt;plugin&gt;
                &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
                &lt;artifactId&gt;sonar-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;2.7.1&lt;/version&gt;
            &lt;/plugin&gt;
....
        &lt;/plugins&gt;        
    &lt;/build&gt;
....
</pre></div></div>

<p>Since SonarQube will process the junit test report, coverage report as well as the source files in the tree, a typical run will include :</p>

<div>
<div>
<pre class="source">$ mvn cobertura:cobertura
$ mvn site:site
$ mvn sonar:sonar
</pre></div></div></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &#169;      2018&#x2013;2019<a href="http://www.tibco.com">TIBCO Software Inc.</a>.
.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
